ALGORITHM: Multi-Modal Food Intake → Nutrition Report + Advice + PDF
(Detailed Architecture with Encoder/Decoder Layers)

INPUTS
  - Food Image (JPG/PNG)
  - Text Input (typed food description)
  - Audio Input (spoken meal description)

OUTPUTS
  - Nutritional Report (JSON: calories + macros + optional micronutrients/notes)
  - Personalized Advice (text)
  - PDF Report (food logs + nutrition + charts)

BEGIN

STEP 1 — USER INTERFACE + INPUT
  1.1 Display START
  1.2 User Interface Options:
      - Upload Food Image (JPG/PNG, variable resolution)
      - Type Text Description (natural language)
      - Record Audio Input (WAV/MP3 format)
  1.3 Receive user input: input_type ∈ {IMAGE, TEXT, AUDIO}

STEP 2 — INPUT ROUTING
  IF input_type = IMAGE:
      Go to STEP 3A (Image Preprocessing)
  ELSE IF input_type = TEXT:
      Go to STEP 3B (Text Preprocessing)
  ELSE IF input_type = AUDIO:
      Go to STEP 3C (Audio Preprocessing + Speech-to-Text)
  END IF

STEP 3A — IMAGE PREPROCESSING (IMAGE PATH)
  3A.1 Image normalization:
       - Resize image to 224 × 224 pixels (ViT-L/14 input size)
       - Center crop if aspect ratio doesn't match
  3A.2 Color space conversion:
       - Convert to RGB (if grayscale or other format)
       - Normalize pixel values to [0, 1] range
  3A.3 Tensor transformation:
       - Convert to PyTorch/TensorFlow tensor
       - Apply standard normalization (mean, std)
       - Shape: [batch_size, 3, 224, 224]
  3A.4 Go to STEP 4A (Image Encoder/Decoder Captioning)

STEP 3B — TEXT PREPROCESSING + ENCODING (TEXT PATH)
  3B.1 Apply token normalization
  3B.2 Perform spell correction
  3B.3 Execute POS tagging (optional, for richer parsing)
  
  3B.4 TEXT ENCODER:
       - Tokenization Layer: WordPiece/BPE tokenization
       - Embedding Layer: Convert tokens to vectors
       - Hidden Layer: 768 dimensions (contextual embeddings)
  
  3B.5 cleaned_text ← preprocessed and encoded text
  3B.6 Go to STEP 4B (Direct Text → Description)

STEP 3C — AUDIO PREPROCESSING + SPEECH-TO-TEXT (AUDIO PATH)
  3C.1 Audio preprocessing:
       - Normalize audio (sample rate to 16kHz, convert to mono)
       - Trim silence, apply denoising (optional)
  
  3C.2 AUDIO ENCODER (Whisper ASR):
       - Mel Spectrogram Conversion: Audio → frequency features
       - Convolutional Layers (2 layers): Feature extraction
       - Transformer Encoder: Self-Attention layers
       - Hidden Layer: 512 dimensions (audio context vector)
       - Decoder: Generate text transcription
  
  3C.3 transcript_raw ← Speech-to-Text output
  
  3C.4 Apply TEXT PREPROCESSING to transcript_raw:
       - Token normalization, spell correction, POS tagging
       - TEXT ENCODER (same as STEP 3B.4)
  
  3C.5 cleaned_text ← preprocessed transcript
  3C.6 Go to STEP 4B (Direct Text → Description)

STEP 4A — IMAGE UNDERSTANDING (ENCODER/DECODER CAPTIONING)
  4A.1 IMAGE ENCODER (ViT-L/14):
       - Patch Embedding Layer: Split image into 16×16 patches
       - Position Embedding: Add spatial information
       - Transformer Blocks (24 layers): Multi-Head Self-Attention
       - Hidden Layer: 1024 dimensions with Layer Normalization
       - Output: 1024-dimensional visual feature vector
  
  4A.2 IMAGE DECODER (BLIP-2 GPT-2):
       - Cross-Attention Layer: Map visual features to text space
       - Transformer Decoder (12 layers): Causal Self-Attention
       - Hidden Layer: 768 dimensions (language model states)
       - Feed-Forward Network: 2048 → 768 dimensions
       - Output Layer: Vocabulary projection
       - caption ← Generated food description
  
  4A.3 Go to STEP 5 (Food Description Fusion)

STEP 4B — TEXT/AUDIO DECODER (DIRECT TEXT PATH)
  4B.1 TEXT PATH DECODER:
       - cleaned_text → direct food description (no generation needed)
  
  4B.2 AUDIO PATH DECODER:
       - transcribed_text → post-processing layer
       - Grammar correction and context refinement
       - Output: food description from audio
  
  4B.3 caption ← cleaned_text (direct user description)
  4B.4 Go to STEP 5 (Food Description Fusion)

STEP 5 — FOOD DESCRIPTION FUSION (PROMPT/CONTEXT MERGE)
  5.1 LangChain Prompt Manager:
      - Input: caption from STEP 4A/4B
      - Context enrichment:
        * Meal time (breakfast/lunch/dinner/snack)
        * Estimated portion sizes
        * Cuisine type
        * User dietary preferences
        * Allergy information
        * Previous meal history
  
  5.2 Prompt Template Construction:
      - Structured prompt format for nutrition estimation
      - Include relevant context tokens
      - combined_description ← Merged and formatted description

STEP 6 — NUTRITIONAL ESTIMATION (RAG + LLM)
  6.1 RAG (Retrieval-Augmented Generation):
      - Vector Store: FAISS or Chroma
      - Embed combined_description into vector space
      - Retrieve top-k similar nutrition references from database
      - Context: food composition data, USDA database, nutrition facts
  
  6.2 LLM INFERENCE (LLaMA-3 8B via Groq):
      - Input: combined_description + retrieved_context
      - Model: LLaMA-3 8B parameters
      - Temperature: 0.3 (for consistent outputs)
      - Max tokens: 1024
      - Prompt engineering: structured nutrition extraction
  
  6.3 OUTPUT PROCESSING:
      - Extract: calories, protein, carbohydrates, fat
      - Optional: fiber, sodium, vitamins, minerals
      - Confidence scores for each estimate
      - nutrition_json ← Structured JSON output

STEP 7 — DAILY TRACKING + STORAGE
  7.1 DATABASE OPERATIONS (PostgreSQL):
      - Insert new food entry:
        * timestamp (date + time)
        * user_id
        * food_description
        * nutrition_json (calories, macros)
        * input_type (image/text/audio)
      - Update daily totals:
        * Aggregate calories
        * Sum macronutrients (protein, carbs, fat)
        * Calculate running totals
  
  7.2 GOAL COMPARISON:
      - Retrieve user goals (daily calorie target, macro targets)
      - Calculate remaining calories/macros
      - Track progress percentage
      - goal_status ← comparison results

STEP 8 — VISUALIZATION
  8.1 CHART GENERATION (Matplotlib/Plotly):
      - Calorie Chart:
        * Bar chart: consumed vs target calories
        * Line chart: daily calorie trends
      - Macronutrient Charts:
        * Pie chart: protein/carbs/fat distribution
        * Stacked bar chart: daily macro breakdown
      - Progress Charts:
        * Goal completion percentage
        * Weekly/monthly trends
  
  8.2 Export charts as images (PNG format) for PDF inclusion

STEP 9 — ADVICE ENGINE
  9.1 INPUT AGGREGATION:
      - Current nutrition_json
      - goal_status from STEP 7.2
      - User profile (age, weight, height, activity level)
      - Historical eating patterns
  
  9.2 GAP ANALYSIS:
      - Calculate calorie deficit/surplus
      - Identify macro imbalances
      - Detect missing nutrients
      - Analyze meal timing patterns
  
  9.3 AI-POWERED ADVICE GENERATION (LLaMA + LangChain):
      - Prompt: gap_analysis + user_context
      - Generate personalized suggestions:
        * Meal recommendations
        * Portion adjustments
        * Nutrient-rich food suggestions
        * Timing optimization
      - advice_text ← Structured advice output

STEP 10 — PDF REPORT GENERATION
  10.1 CONTENT COMPILATION:
      - Header: user info, date range, branding
      - Section 1: Food log summary (all meals with timestamps)
      - Section 2: Nutrition breakdown (tables)
      - Section 3: Visual charts (embedded PNG images)
      - Section 4: Goal comparison (progress metrics)
      - Section 5: Personalized advice (formatted text)
      - Footer: disclaimer, contact info
  
  10.2 PDF GENERATION (FPDF or ReportLab):
      - Page layout: A4, portrait orientation
      - Styling: consistent fonts, colors, spacing
      - pdf_report ← Generated PDF file

STEP 11 — USER DOWNLOAD / SHARE
  11.1 DELIVERY OPTIONS:
      - Save Locally:
        * Download PDF to device
        * Filename: "NutritionReport_YYYY-MM-DD.pdf"
      - Email:
        * Send PDF as attachment
        * Include summary in email body
      - Cloud Storage:
        * Upload to user's cloud account (Google Drive, Dropbox)
        * Generate shareable link
  
  11.2 USER NOTIFICATION:
      - Success message with download/share confirmation
      - Option to view report immediately
  
  11.3 Display END

END


