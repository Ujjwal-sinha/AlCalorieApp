ALGORITHM: Multi-Modal Food Intake → Nutrition Report + Advice + PDF

INPUTS
  - Food Image (JPG/PNG)
  - Text Input (typed food description)
  - Audio Input (spoken meal description)

OUTPUTS
  - Nutritional Report (JSON: calories + macros + optional micronutrients/notes)
  - Personalized Advice (text)
  - PDF Report (food logs + nutrition + charts)

BEGIN

STEP 1 — USER INTERFACE + AUTHENTICATION
  1.1 Display START
  1.2 Authenticate user (e.g., Clerk)
  1.3 Receive user input: input_type ∈ {IMAGE, TEXT, AUDIO}

STEP 2 — INPUT ROUTING
  IF input_type = IMAGE:
      Go to STEP 3A (Image Preprocessing)
  ELSE IF input_type = TEXT:
      Go to STEP 3B (Text Preprocessing)
  ELSE IF input_type = AUDIO:
      Go to STEP 3C (Audio Preprocessing + Speech-to-Text)
  END IF

STEP 3A — IMAGE PREPROCESSING (IMAGE PATH)
  3A.1 Resize image to 224 × 224
  3A.2 Convert image to RGB
  3A.3 Transform image into tensor
  3A.4 Go to STEP 4A (Image Encoder/Decoder Captioning)

STEP 3B — TEXT PREPROCESSING + ENCODING (TEXT PATH)
  3B.1 Apply token normalization
  3B.2 Perform spell correction
  3B.3 Execute POS tagging (optional, for richer parsing)
  
  3B.4 TEXT ENCODER:
       - Tokenization Layer: WordPiece/BPE tokenization
       - Embedding Layer: Convert tokens to vectors
       - Hidden Layer: 768 dimensions (contextual embeddings)
  
  3B.5 cleaned_text ← preprocessed and encoded text
  3B.6 Go to STEP 4B (Direct Text → Description)

STEP 3C — AUDIO PREPROCESSING + SPEECH-TO-TEXT (AUDIO PATH)
  3C.1 (Optional) Normalize audio (sample rate, mono), trim silence, denoise
  3C.2 transcript_raw ← Speech-to-Text(audio)
       - Example model choices: Whisper / cloud ASR provider
  3C.3 Apply TEXT PREPROCESSING to transcript_raw (same as STEP 3B)
  3C.4 cleaned_text ← preprocessed transcript
  3C.5 Go to STEP 4B (Direct Text → Description)

STEP 4A — IMAGE UNDERSTANDING (ENCODER/DECODER CAPTIONING)
  4A.1 IMAGE ENCODER (ViT-L/14):
       - Patch Embedding Layer: Split image into 16×16 patches
       - Position Embedding: Add spatial information
       - Transformer Blocks (24 layers): Multi-Head Self-Attention
       - Hidden Layer: 1024 dimensions with Layer Normalization
       - Output: 1024-dimensional visual feature vector
  
  4A.2 IMAGE DECODER (BLIP-2 GPT-2):
       - Cross-Attention Layer: Map visual features to text space
       - Transformer Decoder (12 layers): Causal Self-Attention
       - Hidden Layer: 768 dimensions (language model states)
       - Feed-Forward Network: 2048 → 768 dimensions
       - Output Layer: Vocabulary projection
       - caption ← Generated food description
  
  4A.3 Go to STEP 5 (Food Description Fusion)

STEP 4B — SKIP CAPTIONING (TEXT/AUDIO PATH)
  4B.1 caption ← cleaned_text  (direct user description)
  4B.2 Go to STEP 5 (Food Description Fusion)

STEP 5 — FOOD DESCRIPTION FUSION (PROMPT/CONTEXT MERGE)
  5.1 combined_description ← LangChain Prompt Manager / Prompt Merger(caption, user context)
      - Optionally include: meal time, portion sizes, cuisine, user preferences, allergies

STEP 6 — NUTRITIONAL ESTIMATION (LLM + RAG)
  6.1 Retrieve relevant nutrition references via RAG:
      - Vector store: FAISS or Chroma
  6.2 nutrition_json ← LLaMA-3 (8B) via Groq(combined_description + retrieved context)
      - Extract calories + macronutrients (protein, carbs, fat)
      - Store structured output as JSON

STEP 7 — DAILY TRACKING + STORAGE
  7.1 Update PostgreSQL:
      - Store entry (timestamp, description, nutrition_json)
      - Update daily totals
  7.2 Compare daily totals with user goals

STEP 8 — VISUALIZATION
  8.1 Generate charts (Matplotlib/Plotly):
      - Calories vs target
      - Macronutrient ratios

STEP 9 — ADVICE ENGINE
  9.1 advice_text ← LLaMA + LangChain(goal comparison + nutrition_json + user profile)
  9.2 Perform gap analysis
  9.3 Generate personalized suggestions

STEP 10 — PDF REPORT
  10.1 Compile: food logs + nutrition_json + charts + advice_text
  10.2 pdf_report ← Generate PDF (FPDF or ReportLab)

STEP 11 — USER DOWNLOAD / SHARE
  11.1 Provide options:
      - Save locally
      - Email
      - Cloud storage
  11.2 Display END

END


